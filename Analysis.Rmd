---
title: "Data Analysis Notebook - MP2"
author: "Bella Cruz, Maria Larmon, Abhi Thanvi"
date: "2023-12-03"
output: pdf_document
toc: yes
header-includes:
  - "\\usepackage{xcolor}"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
# Check if tidyverse is already installed, if not, install it
if (!requireNamespace("tidyverse", quietly = TRUE)) {
  install.packages("tidyverse")
}

# Check if tidyr is already installed, if not, install it
if (!requireNamespace("tidyr", quietly = TRUE)) {
  install.packages("tidyr")
}

# Check if dplyr is already installed, if not, install it
if (!requireNamespace("dplyr", quietly = TRUE)) {
  install.packages("dplyr")
}

# Load the packages
library(tidyverse)

```

# \textcolor{salmon}{Data Profile}
```{r import}
#Reading our dataset
water_pot <- data.frame(read_csv("data/water_potability.csv", 
                                   show_col_types=FALSE))
head(water_pot)
dim(water_pot)
# Cleaning dataset by removing any NA values
water_pot <- na.omit(water_pot)
head(water_pot)
dim(water_pot)
```
# \textcolor{black}{Above, the dataset was cleaned by dropping any NA values for any of the water quality attributes.}

\newpage

\newpage
# \textcolor{cyan!90!blue}{Data Exploration} \vspace{2mm}
\textbf{This section is a exploratory analysis of this data set in order to evaluate the water quality attributes and their relationship with the drinking water status.}

\textbf{1.a)}
```{r import}

correlation_matrix <- round(cor(water_pot), 2)
print(correlation_matrix)

#install.packages("PerformanceAnalytics")
#library("PerformanceAnalytics")
chart.Correlation(water_pot, histogram=TRUE, pch=25)

```
# \textcolor{black}{The correlation matrix provides insight into the relationships between the water quality attributes and potability. It looks like the attribute hardness has zero correlation with the potability, so this attribute is not necessary for fitting a model when potability is the response. Sulfate, conductivity, and organic carbon all have a negative correlation with potability, implying that lower probability of potable water is related to higher levels of sulfate, conductivity, and/or organic carbon in the water. The largest magnitude in the correlation matrix is 0.16, which is relatively larger than the other correlations. This could potentially imply collinearity between sulfate and solids. The graphs visually show the correlation between each of the attributes and the potability. The relationships between potability and ph, Hardness, Chloramines, Sulfate and Organic_carbon all have non-linear trends, implying that these attributes are not effective for predicting a water's potability.}

\newpage
# \textcolor{cyan!90!blue}{Model Fitting} \vspace{2mm}
\textbf{This section fits an appropriate model to this data set in order to make predictions about the potability of water given a set of measurements on water quality attributes.}
```{r import}
#Linear Logit Model
mod <- glm(Potability ~ Solids + Conductivity + Trihalomethanes + Turbidity, family=binomial, data=water_pot)
#library(ResourceSelection)
hl <- hoslem.test(water_pot$Potability, fitted(mod))
print(hl)
```
# \textcolor{black}{Based on the results of the correlation matrix and its visuals, a linear logit model was created with Potability as the reponse variable with the predictors, Solids, Conductivity, Trihalomethanes, and Turbidity. These predictors were chosen because there was a linear trend with each attribute's relationship to potability. From the Hosmer and Lemeshow Goodness-of-fit test, we can assume that the model created is a good fit for the data.}

\newpage 
# \textcolor{cyan!90!blue}{Predictor Selection} \vspace{2mm}
\textbf{This section selects the best predictors determining the water potability. Make sure you take care about potential collinearity issues (if any), and includes appropriate model diagnostics taking into account potential unduly observations.}

\newpage 
# \textcolor{cyan!90!blue}{Model Evaluation - Predictive Power} \vspace{2mm}
\textbf{This section summarizes the predictive power of the final model selected, using correlation based measures and likelihood based measures.}

\newpage 
# \textcolor{cyan!90!blue}{Model Evaluation - Classification Tables} \vspace{2mm}
\textbf{This section uses classification tables to measure the predictive power of the best final model selected based on the results obtained in (c). Implement the leave-one-out cross-validation
method for this step.}

\newpage
**Note: **
Note: You can use the heart disease dataset analysis posted in Canvas Module 6 as a guide
for your analysis. Please note that this is not an extensive analysis but you can use the pieces
of code that you need. More details about this example can be found in Faraway, J.J. (2016):
Extending the Linear Model with R, Chapter 2. A good reference about model diagnostics can
be found in Dunn, P/K. and Smyth, G.K. (2018): Generalized Linear Models with Examples
in R, Chapter 8.



